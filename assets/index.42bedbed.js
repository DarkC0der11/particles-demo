var M=Object.defineProperty;var B=(i,t,e)=>t in i?M(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(B(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();function z(i){return{all:i=i||new Map,on:function(t,e){var s=i.get(t);s?s.push(e):i.set(t,[e])},off:function(t,e){var s=i.get(t);s&&(e?s.splice(s.indexOf(e)>>>0,1):i.set(t,[]))},emit:function(t,e){var s=i.get(t);s&&s.slice().map(function(n){n(e)}),(s=i.get("*"))&&s.slice().map(function(n){n(t,e)})}}}class h{constructor(t,e){r(this,"x",0);r(this,"y",0);this.x=t,this.y=e}static get Zero(){return new h(0,0)}static get One(){return new h(1,1)}static get Up(){return new h(0,-1)}static get Right(){return new h(1,0)}static get Down(){return new h(0,1)}static get Left(){return new h(0,-1)}static Random(){return new h(Math.random()*2-1,Math.random()*2-1)}static RandomBetween(t,e){return new h(Math.random()*(e.x-t.x)+t.x,Math.random()*(e.y-t.y)+t.y)}set(t){return this.x=t.x,this.y=t.y,this}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}scale(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}distance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}normalize(){const t=this.getLength();return this.x/=t,this.y/=t,this}clone(){return new h(this.x,this.y)}}function l(i,t){return new h(i,t)}function L(){}function E(i,t){return Math.random()*(t-i)+i}function I(i,t){return Math.floor(Math.random()*(t-i+1)+i)}function T(i,t){const e=Math.random()*Math.PI*2,s=Math.cos(e)*t+i.x,n=Math.sin(e)*t+i.y;return l(s,n)}function C(i){return i*Math.PI/180}function O(i,t){const e=Math.random()*Math.PI*2,s=Math.random(),n=Math.cos(e)*t*s+i.x,a=Math.sin(e)*t*s+i.y;return l(n,a)}function R(i,t,e){const s=Math.random()*t+i.x,n=Math.random()*e+i.y;return l(s,n)}function D(){const i=Math.random()*255,t=Math.random()*255,e=Math.random()*255,s=Math.random();return`rgba(${i}, ${t}, ${e}, ${s})`}const k=1e3;class A{constructor(){r(this,"rateOverTime",10);r(this,"bursts",[]);r(this,"isEnabled",!0);r(this,"_burstTimestamp",0);r(this,"_previousBurstIndex",-1);r(this,"_timeSinceLastEmission",0);r(this,"events",z())}get isUsingBursts(){return this.bursts.length>0}_handleBursts(t){this._burstTimestamp+=t;const e=this.bursts.findIndex((n,a)=>this._burstTimestamp>n.time&&a>this._previousBurstIndex);if(e===-1||this._previousBurstIndex===e)return;const s=this.bursts[e];if(this._burstTimestamp>s.time){const n=I(s.min,s.max);this.events.emit("emit",n),e===this.bursts.length-1?(this._burstTimestamp=0,this._previousBurstIndex=-1,this.events.emit("last-burst")):this._previousBurstIndex=e}}_handleRateOverTime(t){const e=Math.floor(this.rateOverTime*this._timeSinceLastEmission/k);e>0&&(this.events.emit("emit",e),this._timeSinceLastEmission=0),this._timeSinceLastEmission=this._timeSinceLastEmission+t}tick(t){!this.isEnabled||(this.bursts.length>0?this._handleBursts(t):this._handleRateOverTime(t))}}function V(){return new A}let F=0;class U{constructor(){r(this,"id",F++);r(this,"position",h.Zero);r(this,"rotation",0);r(this,"scale",1);r(this,"velocity",h.Zero);r(this,"angularVelocity",0);r(this,"acceleration",h.Zero);r(this,"age",0);r(this,"lifeTime",1e3);r(this,"color");r(this,"texture");r(this,"size",48);r(this,"alpha",1);r(this,"compositeOperation")}get isDead(){return this.age>=this.lifeTime}applyForce(t){this.acceleration.add(t)}tick(t){this.age+=t,this.rotation+=this.angularVelocity*t,this.velocity.add(this.acceleration),this.position.add(this.velocity.clone().scale(t)),this.acceleration.multiply(h.Zero)}}function j(){return new U}class Z{constructor(t){r(this,"_pool",[]);r(this,"_factory");r(this,"_reset");var e;this._factory=t.factory,this._reset=(e=t.reset)!=null?e:L}allocate(){if(this._pool.length>0){const t=this._pool.pop();return this._reset(t),t}return this._factory()}receive(t){this._pool.push(t)}}function N(i){return new Z(i)}class ${constructor(t={}){r(this,"shapeType");r(this,"radius");r(this,"width");r(this,"height");var e,s,n,a;this.shapeType=(e=t.shape)!=null?e:"point",this.radius=(s=t.radius)!=null?s:75,this.width=(n=t.width)!=null?n:150,this.height=(a=t.height)!=null?a:150}getSpawnPosition(t){const e=t.position;return this.shapeType==="circle"?O(e,this.radius):this.shapeType==="ring"?T(e,this.radius):this.shapeType==="rectangle"?R(e.clone().subtract(new h(this.width*.5,this.height*.5)),this.width,this.height):e}}function q(i={}){return new $(i)}class K{constructor(){r(this,"_parent");r(this,"subEmitters",[]);r(this,"_subParticleSystems",[]);this._handleParticleSystemParticleDeath=this._handleParticleSystemParticleDeath.bind(this)}_handleParticleSystemParticleDeath(t){const e=this.subEmitters.find(s=>s.triggerCondition==="death");if(!!e)if(e.particleSystemFactory){const s=e.particleSystemFactory();if(!s.emission.isUsingBursts)throw new Error("Sub-emitter particle system must use bursts");s.position.set(t.position),this._subParticleSystems.push(s)}else this._parent.allocateAndPrepareParticle().position.set(t.position)}register(t){t.events.on("particle-death",this._handleParticleSystemParticleDeath),this._parent=t}unregister(t){t.events.off("particle-death",this._handleParticleSystemParticleDeath)}tick(t){this._subParticleSystems.forEach(e=>{e.tick(t),e.hasCompleted&&(this._subParticleSystems=this._subParticleSystems.filter(s=>s!==e))})}}function H(){return new K}class W{constructor({renderer:t}){r(this,"renderer");r(this,"position",h.Zero);r(this,"duration",1e3);r(this,"isLooping",!0);r(this,"_objectPool");r(this,"_particles",[]);r(this,"_initializers",new Set);r(this,"_behaviors",new Set);r(this,"_timestamp",0);r(this,"_hasEmitterUsedLastBurst",!1);r(this,"events",z());r(this,"emission",V());r(this,"shape",q());r(this,"subEmitters",H());this._objectPool=N({factory:()=>j(),reset:e=>{e.velocity=h.Zero,e.acceleration=h.Zero,e.age=0,e.angularVelocity=0}}),this.renderer=t,this.emission.events.on("emit",e=>this.emitParticles(e)),this.emission.events.on("last-burst",()=>{this._hasEmitterUsedLastBurst=!0}),this.subEmitters.register(this)}get particlesCount(){return this._particles.length}get hasCompleted(){if(this.isLooping)return!1;const t=this._particles.some(e=>!e.isDead);return this._timestamp>=this.duration&&!t}get _shouldEmitterTick(){return this.isLooping||!this.emission.isUsingBursts&&this._timestamp<this.duration?!0:this.emission.isUsingBursts&&!this._hasEmitterUsedLastBurst}tick(t){this._timestamp+=t,this._shouldEmitterTick&&this.emission.tick(t),this._updateParticles(t),this.subEmitters.tick(t)}reset(){this._timestamp=0,this._hasEmitterUsedLastBurst=!1,this._particles.forEach(t=>{this._objectPool.receive(t)}),this._particles=[]}addBehavior(t){this._behaviors.add(t)}removeBehavior(t){this._behaviors.delete(t)}addInitializer(t){this._initializers.add(t)}removeInitializer(t){this._initializers.delete(t)}allocateAndPrepareParticle(){const t=this._objectPool.allocate();return this._behaviors.forEach(e=>{e.initialize(t)}),this._initializers.forEach(e=>e.initialize(t)),this._particles.push(t),t}emitParticles(t){for(let e=0;e<t;e++){const s=this.allocateAndPrepareParticle(),n=this.shape.getSpawnPosition(this);s.position.set(n)}}_updateParticles(t){this._particles.forEach(e=>{if(e.isDead){this.events.emit("particle-death",e),this._behaviors.forEach(s=>s.reset(e)),this._objectPool.receive(e),this._particles=this._particles.filter(s=>s.id!==e.id);return}this._behaviors.forEach(s=>s.applyBehavior(e,t)),e.tick(t),this.renderer.renderParticle(e)})}}function v(i){return new W(i)}const y=new Map;function G(i,t){return`${i.src}-${t}`}function J(i,t){const e=G(i,t);if(y.has(e))return y.get(e);const s=document.createElement("canvas"),n=s.getContext("2d");return s.width=i.width,s.height=i.height,n.drawImage(i,0,0),n.globalCompositeOperation="source-in",n.fillStyle=t,n.fillRect(0,0,s.width,s.height),y.set(e,s),s}function Q(i){return{renderParticle(t){const{color:e,scale:s,size:n,position:a,texture:o,alpha:c,rotation:_,compositeOperation:d}=t;i.save(),i.globalAlpha=c,d&&(i.globalCompositeOperation=d);const p=n*s,f=p/2;if(o){let g=o;e&&(g=J(o,e)),i.translate(a.x,a.y),i.rotate(C(_)),i.translate(-a.x,-a.y),i.drawImage(g,a.x-f,a.y-f,p,p)}else i.beginPath(),i.arc(a.x,a.y,p,0,2*Math.PI),i.closePath(),i.fillStyle=e!=null?e:"rgba(255, 255, 255, 1)",i.fill();i.restore()}}}class X{constructor(t){r(this,"_canvas");r(this,"_context");r(this,"_particleSystems",[]);r(this,"_previousTimestamp",0);this._canvas=t,this._context=t.getContext("2d"),this._tick=this._tick.bind(this),this._tick(0),this._handleDocumentVisibilityChange=this._handleDocumentVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._handleDocumentVisibilityChange)}destroy(){document.removeEventListener("visibilitychange",this._handleDocumentVisibilityChange)}_handleDocumentVisibilityChange(){document.hidden||(this._previousTimestamp=performance.now())}addParticleSystem(t){this._particleSystems.push(t)}_tick(t){const e=t-this._previousTimestamp;this._context.fillStyle="#000",this._context.fillRect(0,0,this._canvas.width,this._canvas.height),this._particleSystems.forEach(s=>s.tick(e)),this._previousTimestamp=t,requestAnimationFrame(this._tick)}}function Y(i){return new X(i)}const tt="/particles-demo/assets/particle-1.89f6f732.png",et="/particles-demo/assets/particle-2.6ee2d798.png";class u{initialize(t){throw new Error("Not implemented")}}class it extends u{constructor(t){super(),this._color=t}initialize(t){t.color=this._color}setColor(t){this._color=t}}class st extends u{constructor(t){super(),this._colors=t}initialize(t){t.color=this._colors[Math.floor(Math.random()*this._colors.length)]}}class w extends u{constructor(t,e){super(),this._min=t,this._max=e}initialize(t){this._min===this._max?t.size=this._min:t.size=E(this._min,this._max)}}class b extends u{constructor(t){super(),this._texture=t}initialize(t){t.texture=this._texture}}class x extends u{constructor(t){super(),this._compositeOperation=t}initialize(t){t.compositeOperation=this._compositeOperation}}class rt extends u{constructor(t,e){super(),this.min=t,this.max=e}initialize(t){t.lifeTime=I(this.min,this.max)}}class m{initialize(t){}reset(t){}applyBehavior(t,e){throw new Error("Method not implemented.")}}class P extends m{constructor(t){super(),this._force=t}applyBehavior(t){t.applyForce(this._force)}}class nt extends m{constructor(t){super(),this._maxVelocity=t}applyBehavior(t){t.velocity.getLength()>this._maxVelocity&&(t.velocity=t.velocity.normalize().scale(this._maxVelocity))}}class at extends m{constructor(e){super();r(this,"_cache");this._angularVelocity=e,Array.isArray(this._angularVelocity)&&(this._cache=new Map)}reset(e){var s;(s=this._cache)==null||s.delete(e.id)}applyBehavior(e){var s,n;if(Array.isArray(this._angularVelocity)){let a=(s=this._cache)==null?void 0:s.get(e.id);a===void 0&&(a=E(this._angularVelocity[0],this._angularVelocity[1]),(n=this._cache)==null||n.set(e.id,a)),e.angularVelocity=a}else e.angularVelocity=this._angularVelocity}}class ot extends m{constructor(t,e,s){super(),this._from=t,this._to=e,this._duration=s}applyBehavior(t){var s;const e=t.age/((s=this._duration)!=null?s:t.lifeTime);t.scale=this._from+(this._to-this._from)*e}}class ht extends m{constructor(t,e,s){super(),this._from=t,this._to=e,this._duration=s}applyBehavior(t){var s;const e=t.age/((s=this._duration)!=null?s:t.lifeTime);t.alpha=this._from+(this._to-this._from)*e}}class S extends u{constructor(t){super(),this._velocity=t}initialize(t){Array.isArray(this._velocity)?t.velocity=h.RandomBetween(this._velocity[0],this._velocity[1]):t.velocity=this._velocity}}lt();const ct=Array.from({length:15}).map(()=>D());async function lt(){const i=[tt,et].map(c=>new Promise(_=>{const d=new Image;d.addEventListener("load",()=>_(d)),d.src=c})),[,t]=await Promise.all(i),e=document.querySelector("#canvas"),s=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const n=Q(s),a=()=>{const c=v({renderer:n});return c.duration=1e3,c.isLooping=!1,c.emission.bursts=[{time:0,min:100,max:200}],c.addInitializer(new st(ct)),c.addInitializer(new b(t)),c.addInitializer(new w(20,20)),c.addInitializer(new S([l(-.2,-.2),l(.2,.2)])),c.addInitializer(new x("lighter")),c.addInitializer(new rt(1e3,3e3)),c.addBehavior(new at([-.3,.3])),c.addBehavior(new ot(1,0)),c.addBehavior(new ht(1,0)),c.addBehavior(new P(l(0,.001))),c},o=v({renderer:n});o.subEmitters.subEmitters=[{triggerCondition:"death",particleSystemFactory:a}],o.position=l(e.width/2,e.height*.8),o.isLooping=!0,o.duration=1e3,o.emission.rateOverTime=5,o.shape.shapeType="point",o.shape.radius=Math.min(e.width,e.height)/2*.8,o.addInitializer(new it("orange")),o.addInitializer(new b(t)),o.addInitializer(new w(20,20)),o.addInitializer(new S([l(-.6,-.7),l(.6,-.6)])),o.addInitializer(new x("lighter")),o.addBehavior(new nt(3)),o.addBehavior(new P(l(0,.005))),Y(e).addParticleSystem(o),window.ps=o}
